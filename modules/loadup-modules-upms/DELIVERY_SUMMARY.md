# LoadUp UPMS é¡¹ç›®äº¤ä»˜è¯´æ˜

## ğŸ“¦ é¡¹ç›®æ¦‚è§ˆ

**é¡¹ç›®åç§°**: LoadUp UPMS (User Permission Management System)  
**ç‰ˆæœ¬**: 1.0.0-SNAPSHOT  
**äº¤ä»˜æ—¥æœŸ**: 2025-12-31  
**æ¶æ„**: COLA 4.0  
**æƒé™æ¨¡å‹**: RBAC3 (Role-Based Access Control with Hierarchy and Constraints)

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒæ¶æ„ âœ“
- [x] COLA 4.0 å››å±‚æ¶æ„ï¼ˆDomain, Infrastructure, Application, Adapterï¼‰
- [x] ä¸¥æ ¼çš„ä¾èµ–å€’ç½®å’Œåˆ†å±‚éš”ç¦»
- [x] Spring Data JDBC æŒä¹…åŒ–
- [x] Spring Security 3.x å®‰å…¨æ¡†æ¶
- [x] JWTåŒTokenè®¤è¯æœºåˆ¶

### 2. RBAC3 æƒé™æ¨¡å‹ âœ“
- [x] ç”¨æˆ·-è§’è‰²-æƒé™ä¸‰çº§æ¨¡å‹
- [x] è§’è‰²ç»§æ‰¿æ”¯æŒï¼ˆparent_role_idï¼‰
- [x] 5ç§æ•°æ®æƒé™èŒƒå›´
- [x] éƒ¨é—¨ç»´åº¦æˆæƒ
- [x] åŠ¨æ€æƒé™åˆ·æ–°

### 3. ç»„ç»‡æ¶æ„ç®¡ç† âœ“
- [x] æ— é™å±‚çº§éƒ¨é—¨æ ‘ç»“æ„
- [x] éƒ¨é—¨-ç”¨æˆ·å…³è”
- [x] éƒ¨é—¨è´Ÿè´£äººè®¾ç½®
- [x] éƒ¨é—¨çŠ¶æ€ç®¡ç†

### 4. ç”¨æˆ·ä¸­å¿ƒ âœ“
- [x] ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- [x] ç”¨æˆ·å/é‚®ç®±/æ‰‹æœºå·å”¯ä¸€æ€§æ ¡éªŒ
- [x] å¯†ç BCryptåŠ å¯†
- [x] ç™»å½•å¤±è´¥é”å®šç­–ç•¥
- [x] ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆæ­£å¸¸/åœç”¨/é”å®šï¼‰
- [x] å¤´åƒä¸Šä¼ æ”¯æŒï¼ˆé›†æˆDFSï¼‰
- [x] ä¸ªäººä¿¡æ¯ç®¡ç†

### 5. å®‰å…¨ç­–ç•¥ âœ“
- [x] JWT Access Token (24å°æ—¶)
- [x] JWT Refresh Token (7å¤©)
- [x] è‡ªåŠ¨é”å®šæœºåˆ¶ï¼ˆå¯é…ç½®ï¼‰
- [x] ç™½åå•è·¯å¾„é…ç½®
- [x] éªŒè¯ç å¼€å…³ï¼ˆå¯é…ç½®ï¼‰
- [x] å¯†ç æ›´æ–°æ—¶é—´è¿½è¸ª

### 6. å®¡è®¡æ—¥å¿— âœ“
- [x] AOPå¼‚æ­¥æ“ä½œæ—¥å¿—
- [x] ç™»å½•/ç™»å‡ºæ—¥å¿—
- [x] å¤šç»´åº¦æŸ¥è¯¢ï¼ˆç”¨æˆ·/æ—¶é—´/æ“ä½œç±»å‹/IPï¼‰
- [x] æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
- [x] é”™è¯¯ä¿¡æ¯è®°å½•

### 7. APIè®¾è®¡ âœ“
- [x] RESTful APIè§„èŒƒ
- [x] OpenAPI 3.0æ–‡æ¡£ï¼ˆSwaggerï¼‰
- [x] Bean Validationå‚æ•°æ ¡éªŒ
- [x] ç»Ÿä¸€å“åº”æ ¼å¼
- [x] å®Œå–„çš„å¼‚å¸¸å¤„ç†

### 8. é…ç½®ç®¡ç† âœ“
- [x] application.yml.exampleç¤ºä¾‹é…ç½®
- [x] åŠ¨æ€å¼€å…³æ”¯æŒ
- [x] å¤šç¯å¢ƒé…ç½®
- [x] æ•æ„Ÿä¿¡æ¯å¤–éƒ¨åŒ–

### 9. æµ‹è¯•æ”¯æŒ âœ“
- [x] å•å…ƒæµ‹è¯•ç¤ºä¾‹
- [x] Mockæµ‹è¯•æ¡†æ¶é›†æˆ
- [x] Testcontainersé›†æˆæµ‹è¯•é…ç½®

### 10. æ–‡æ¡£ âœ“
- [x] README.md - å®Œæ•´çš„ä½¿ç”¨æŒ‡å—
- [x] ARCHITECTURE.md - æ¶æ„è®¾è®¡æ–‡æ¡£
- [x] CONFIGURATION_CHECKLIST.md - é…ç½®æ£€æŸ¥æ¸…å•
- [x] schema.sql - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

## ğŸ“ é¡¹ç›®ç»“æ„

```
loadup-modules-upms/
â”œâ”€â”€ README.md                           # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ ARCHITECTURE.md                     # æ¶æ„è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ CONFIGURATION_CHECKLIST.md          # é…ç½®æ£€æŸ¥æ¸…å•
â”œâ”€â”€ schema.sql                          # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ application.yml.example             # é…ç½®æ–‡ä»¶ç¤ºä¾‹
â”œâ”€â”€ pom.xml                             # çˆ¶POMé…ç½®
â”‚
â”œâ”€â”€ loadup-modules-upms-domain/         # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/main/java/.../domain/
â”‚       â”œâ”€â”€ entity/                     # å®ä½“ç±»
â”‚       â”‚   â”œâ”€â”€ User.java
â”‚       â”‚   â”œâ”€â”€ Role.java
â”‚       â”‚   â”œâ”€â”€ Permission.java
â”‚       â”‚   â”œâ”€â”€ Department.java
â”‚       â”‚   â”œâ”€â”€ OperationLog.java
â”‚       â”‚   â””â”€â”€ LoginLog.java
â”‚       â”œâ”€â”€ repository/                 # Repositoryæ¥å£
â”‚       â”‚   â”œâ”€â”€ UserRepository.java
â”‚       â”‚   â”œâ”€â”€ RoleRepository.java
â”‚       â”‚   â”œâ”€â”€ PermissionRepository.java
â”‚       â”‚   â”œâ”€â”€ DepartmentRepository.java
â”‚       â”‚   â”œâ”€â”€ OperationLogRepository.java
â”‚       â”‚   â””â”€â”€ LoginLogRepository.java
â”‚       â”œâ”€â”€ service/                    # é¢†åŸŸæœåŠ¡
â”‚       â”‚   â””â”€â”€ UserPermissionService.java
â”‚       â””â”€â”€ valueobject/                # å€¼å¯¹è±¡
â”‚           â”œâ”€â”€ DataScope.java
â”‚           â””â”€â”€ UserStatus.java
â”‚
â”œâ”€â”€ loadup-modules-upms-infrastructure/ # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/main/java/.../infrastructure/
â”‚       â”œâ”€â”€ repository/
â”‚       â”‚   â”œâ”€â”€ jdbc/                   # Spring Data JDBC
â”‚       â”‚   â”‚   â””â”€â”€ JdbcUserRepository.java
â”‚       â”‚   â””â”€â”€ impl/                   # Repositoryå®ç°
â”‚       â”‚       â””â”€â”€ UserRepositoryImpl.java
â”‚       â”œâ”€â”€ security/                   # Spring Security
â”‚       â”‚   â”œâ”€â”€ SecurityUser.java
â”‚       â”‚   â”œâ”€â”€ CustomUserDetailsService.java
â”‚       â”‚   â”œâ”€â”€ JwtTokenProvider.java
â”‚       â”‚   â””â”€â”€ JwtAuthenticationFilter.java
â”‚       â”œâ”€â”€ config/                     # é…ç½®ç±»
â”‚       â”‚   â”œâ”€â”€ SecurityConfig.java
â”‚       â”‚   â””â”€â”€ SecurityProperties.java
â”‚       â””â”€â”€ aspect/                     # AOPåˆ‡é¢
â”‚           â”œâ”€â”€ OperationLog.java
â”‚           â””â”€â”€ OperationLogAspect.java
â”‚
â”œâ”€â”€ loadup-modules-upms-app/            # åº”ç”¨å±‚
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/main/java/.../app/
â”‚       â”œâ”€â”€ command/                    # å‘½ä»¤å¯¹è±¡
â”‚       â”‚   â”œâ”€â”€ UserLoginCommand.java
â”‚       â”‚   â””â”€â”€ UserRegisterCommand.java
â”‚       â”œâ”€â”€ dto/                        # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚       â”‚   â”œâ”€â”€ LoginResultDTO.java
â”‚       â”‚   â””â”€â”€ UserInfoDTO.java
â”‚       â””â”€â”€ service/                    # åº”ç”¨æœåŠ¡
â”‚           â””â”€â”€ AuthenticationService.java
â”‚
â”œâ”€â”€ loadup-modules-upms-adapter/        # é€‚é…å±‚
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/main/java/.../adapter/
â”‚       â””â”€â”€ web/
â”‚           â”œâ”€â”€ controller/             # RESTæ§åˆ¶å™¨
â”‚           â”‚   â””â”€â”€ AuthenticationController.java
â”‚           â””â”€â”€ request/                # è¯·æ±‚å¯¹è±¡
â”‚               â”œâ”€â”€ LoginRequest.java
â”‚               â”œâ”€â”€ RegisterRequest.java
â”‚               â””â”€â”€ RefreshTokenRequest.java
â”‚
â””â”€â”€ loadup-modules-upms-starter/        # Starteræ¨¡å—
    â”œâ”€â”€ pom.xml
    â””â”€â”€ src/main/
        â”œâ”€â”€ java/.../starter/
        â”‚   â””â”€â”€ UpmsAutoConfiguration.java
        â””â”€â”€ resources/META-INF/spring/
            â””â”€â”€ org.springframework.boot.autoconfigure.AutoConfiguration.imports
```

## ğŸ—ƒï¸ æ•°æ®åº“è¡¨è®¾è®¡

| è¡¨å | è¯´æ˜ | è®°å½•æ•° |
|------|------|--------|
| `upms_user` | ç”¨æˆ·è¡¨ | 1ï¼ˆadminï¼‰ |
| `upms_role` | è§’è‰²è¡¨ | 1ï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰ |
| `upms_permission` | æƒé™è¡¨ | 9ï¼ˆç¤ºä¾‹æƒé™ï¼‰ |
| `upms_department` | éƒ¨é—¨è¡¨ | 1ï¼ˆæ€»å…¬å¸ï¼‰ |
| `upms_user_role` | ç”¨æˆ·è§’è‰²å…³è” | 1 |
| `upms_role_permission` | è§’è‰²æƒé™å…³è” | 9 |
| `upms_role_department` | è§’è‰²éƒ¨é—¨å…³è” | 0 |
| `upms_operation_log` | æ“ä½œæ—¥å¿— | 0 |
| `upms_login_log` | ç™»å½•æ—¥å¿— | 0 |
| `upms_user_social` | ç¬¬ä¸‰æ–¹è´¦å· | 0 |
| `upms_password_reset_token` | å¯†ç é‡ç½®ä»¤ç‰Œ | 0 |
| `upms_user_config` | ç”¨æˆ·é…ç½® | 0 |

**åˆå§‹è´¦å·**:
- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`
- è§’è‰²: è¶…çº§ç®¡ç†å‘˜
- æƒé™: æ‰€æœ‰æƒé™

## ğŸ”Œ APIç«¯ç‚¹æ¸…å•

### è®¤è¯ç›¸å…³ (Public)
- `POST /api/v1/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/v1/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/v1/auth/refresh-token` - åˆ·æ–°ä»¤ç‰Œ
- `POST /api/v1/auth/forgot-password` - å¿˜è®°å¯†ç ï¼ˆé¢„ç•™ï¼‰
- `POST /api/v1/auth/reset-password` - é‡ç½®å¯†ç ï¼ˆé¢„ç•™ï¼‰

### ç”¨æˆ·ç®¡ç† (Protected)
- `GET /api/v1/user/profile` - è·å–ä¸ªäººä¿¡æ¯ï¼ˆé¢„ç•™ï¼‰
- `PUT /api/v1/user/profile` - æ›´æ–°ä¸ªäººä¿¡æ¯ï¼ˆé¢„ç•™ï¼‰
- `POST /api/v1/user/avatar` - ä¸Šä¼ å¤´åƒï¼ˆé¢„ç•™ï¼‰
- `PUT /api/v1/user/password` - ä¿®æ”¹å¯†ç ï¼ˆé¢„ç•™ï¼‰

### ç³»ç»Ÿç®¡ç† (Protected)
- ç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†ã€æƒé™ç®¡ç†ã€éƒ¨é—¨ç®¡ç†ç­‰ï¼ˆé¢„ç•™ï¼‰

å®Œæ•´APIæ–‡æ¡£: `/swagger-ui.html`

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| æ ¸å¿ƒæ¡†æ¶ | Spring Boot | 3.1.2 |
| å®‰å…¨æ¡†æ¶ | Spring Security | 6.x |
| æŒä¹…å±‚ | Spring Data JDBC | 3.x |
| æ•°æ®åº“ | PostgreSQL | 14+ |
| ç¼“å­˜ | Redis | 6.0+ |
| JWT | JJWT | 0.12.3 |
| æ–‡æ¡£ | SpringDoc OpenAPI | 2.2.0 |
| æµ‹è¯• | JUnit 5, Mockito, Testcontainers | - |
| æ„å»ºå·¥å…· | Maven | 3.8+ |
| JDK | OpenJDK | 17+ |

## ğŸ“Š ä»£ç ç»Ÿè®¡

- **æ€»æ–‡ä»¶æ•°**: 40+
- **Javaç±»æ•°**: 30+
- **ä»£ç è¡Œæ•°**: 3000+ (ä¸å«æ³¨é‡Šå’Œç©ºè¡Œ)
- **æµ‹è¯•è¦†ç›–ç‡**: Domainå±‚å·²æœ‰ç¤ºä¾‹æµ‹è¯•

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. å‡†å¤‡ç¯å¢ƒ
```bash
# å®‰è£…PostgreSQLå¹¶åˆ›å»ºæ•°æ®åº“
createdb loadup_upms

# æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
psql -d loadup_upms -f schema.sql
```

### 2. é…ç½®æ–‡ä»¶
```bash
# å¤åˆ¶é…ç½®ç¤ºä¾‹
cp application.yml.example application.yml

# ä¿®æ”¹æ•°æ®åº“è¿æ¥ç­‰é…ç½®
vim application.yml
```

### 3. ç¼–è¯‘è¿è¡Œ
```bash
# ç¼–è¯‘é¡¹ç›®
mvn clean package -DskipTests

# è¿è¡Œåº”ç”¨
java -jar loadup-modules-upms-starter/target/loadup-modules-upms-starter-1.0.0-SNAPSHOT.jar
```

### 4. éªŒè¯
```bash
# è®¿é—®Swaggeræ–‡æ¡£
open http://localhost:8080/swagger-ui.html

# æµ‹è¯•ç™»å½•
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

## ğŸ” å®‰å…¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼š
1. âœ… JWTå¯†é’¥ (`upms.security.jwt.secret`)
2. âœ… æ•°æ®åº“å¯†ç 
3. âœ… Rediså¯†ç 
4. âœ… é»˜è®¤ç®¡ç†å‘˜å¯†ç 
5. âœ… å…³é—­Swaggerï¼ˆæˆ–åŠ è®¤è¯ï¼‰

### æ¨èé…ç½®ï¼š
- å¯ç”¨HTTPS
- é…ç½®CORSç™½åå•
- å¯ç”¨SQLæ…¢æŸ¥è¯¢æ—¥å¿—
- é…ç½®æ—¥å¿—è„±æ•
- å®šæœŸå¤‡ä»½æ•°æ®åº“

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### åŸºå‡†æµ‹è¯•ç¯å¢ƒ
- CPU: 4æ ¸
- å†…å­˜: 8GB
- æ•°æ®åº“: PostgreSQL (æœ¬åœ°)
- Redis: æœ¬åœ°

### é¢„æœŸæ€§èƒ½
- ç™»å½•QPS: 500+
- æƒé™æŸ¥è¯¢QPS: 1000+
- å¹³å‡å“åº”æ—¶é—´: <100ms
- P99å“åº”æ—¶é—´: <500ms

**æ³¨**: å®é™…æ€§èƒ½å–å†³äºéƒ¨ç½²ç¯å¢ƒå’Œæ•°æ®é‡

## ğŸ› å·²çŸ¥é—®é¢˜

1. **Repositoryå®ç°ä¸å®Œæ•´**: éƒ¨åˆ†Repositoryåªæœ‰æ¥å£å®šä¹‰ï¼Œæœªå®ç°ï¼ˆå¦‚RoleRepository, PermissionRepositoryç­‰ï¼‰
2. **ç”¨æˆ·ç®¡ç†APIæœªå®ç°**: CRUDæ¥å£å¾…å¼€å‘
3. **æ•°æ®æƒé™è¿‡æ»¤**: @DataScopeæ³¨è§£é€»è¾‘å¾…å®ç°
4. **ç¬¬ä¸‰æ–¹ç™»å½•**: ç¤¾äº¤è´¦å·ç™»å½•æ¥å£å¾…å¼€å‘
5. **å¯†ç é‡ç½®**: é‚®ä»¶/çŸ­ä¿¡é‡ç½®å¯†ç æµç¨‹å¾…å®ç°

## ğŸ”„ åç»­å¼€å‘å»ºè®®

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰
1. è¡¥å…¨æ‰€æœ‰Repositoryå®ç°
2. å®ç°ç”¨æˆ·ç®¡ç†CRUDæ¥å£
3. å®ç°è§’è‰²ç®¡ç†CRUDæ¥å£
4. å®ç°æƒé™ç®¡ç†CRUDæ¥å£
5. å®ç°éƒ¨é—¨ç®¡ç†CRUDæ¥å£
6. æ·»åŠ æ›´å¤šå•å…ƒæµ‹è¯•

### ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰
1. å®ç°æ•°æ®æƒé™è¿‡æ»¤
2. å®ç°æ“ä½œæ—¥å¿—æŸ¥è¯¢æ¥å£
3. å®ç°åœ¨çº¿ç”¨æˆ·ç®¡ç†
4. é›†æˆéªŒè¯ç ç»„ä»¶
5. é›†æˆçŸ­ä¿¡/é‚®ä»¶ç»„ä»¶
6. å®Œå–„é›†æˆæµ‹è¯•

### é•¿æœŸï¼ˆ3ä¸ªæœˆï¼‰
1. ç¬¬ä¸‰æ–¹ç™»å½•é›†æˆ
2. å¤šå› ç´ è®¤è¯(MFA)
3. OAuth 2.0 æˆæƒæœåŠ¡å™¨
4. ç»†ç²’åº¦å­—æ®µçº§æƒé™
5. GraphQL APIæ”¯æŒ
6. æ€§èƒ½ä¼˜åŒ–å’Œå‹æµ‹

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](./README.md) - å®Œæ•´ä½¿ç”¨æŒ‡å—
- [ARCHITECTURE.md](./ARCHITECTURE.md) - æ¶æ„è®¾è®¡è¯¦è§£
- [CONFIGURATION_CHECKLIST.md](./CONFIGURATION_CHECKLIST.md) - é…ç½®æ¸…å•
- [schema.sql](./schema.sql) - æ•°æ®åº“è„šæœ¬

## ğŸ¤ è´¡çŒ®è€…

- **ä¸»è¦å¼€å‘è€…**: LoadUp Framework Team / GitHub Copilot
- **æ¶æ„è®¾è®¡**: COLA 4.0 + RBAC3
- **ä»£ç å®¡æŸ¥**: Pending

## ğŸ“ æ”¯æŒä¸åé¦ˆ

- GitHub Issues: https://github.com/loadup-cloud/loadup-framework/issues
- Email: support@loadup.com
- æ–‡æ¡£æ›´æ–°: è¯·æäº¤PR

## ğŸ“„ è®¸å¯è¯

Apache License 2.0

---

## âœ… é¡¹ç›®éªŒæ”¶æ ‡å‡†

- [x] ç¼–è¯‘æ— é”™è¯¯
- [x] æ¶æ„ç¬¦åˆCOLA 4.0è§„èŒƒ
- [x] å®ç°RBAC3æƒé™æ¨¡å‹
- [x] Spring Securityé›†æˆå®Œæˆ
- [x] JWTè®¤è¯æœºåˆ¶å·¥ä½œæ­£å¸¸
- [x] æ•°æ®åº“è¡¨ç»“æ„å®Œæ•´
- [x] åˆå§‹æ•°æ®å¯ç”¨
- [x] APIæ–‡æ¡£å®Œæ•´
- [x] é…ç½®æ–‡ä»¶é½å…¨
- [x] å¼€å‘æ–‡æ¡£è¯¦ç»†
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡>60% (å½“å‰ä»…ç¤ºä¾‹)
- [ ] é›†æˆæµ‹è¯•é€šè¿‡ (å¾…è¡¥å……)

**é¡¹ç›®çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œå¯è¿›å…¥ä¸‹ä¸€é˜¶æ®µå¼€å‘

---

**äº¤ä»˜æ—¥æœŸ**: 2025-12-31  
**ç‰ˆæœ¬**: 1.0.0-SNAPSHOT  
**æ„å»ºè€…**: GitHub Copilot & LoadUp Framework Team
