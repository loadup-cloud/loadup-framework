<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <!--日志参数配置默认从antcloud.properties、opensource.properties、gateway-core.properties取,见starter配置规范：https://yuque.antfin-inc.com/docs/share/7157d38b-d853-4de1-972e-c3da91f71ddc# -->
    <property resource="antcloud.properties"/>
    <property resource="opensource.properties"/>
    <property resource="gateway-core.properties"/>
    <!--轻应用中application.properties文件可覆盖默认日志配置-->
    <property resource="application.properties"/>
    <property resource="config/application.properties"/>

    <!--输出到控制台-->
    <appender name="CONSOLE-APPENDER" class="ch.qos.logback.core.ConsoleAppender">
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>${application.system.logging.level}</level>
        </filter>
        <encoder>
            <Pattern>${spring.cloud.antfin.customized.patternlayout}</Pattern>
            <!-- 设置字符集 -->
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <appender name="COMMON-ERROR-APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${application.system.logging.path}/${component.gateway.name}/common-error.log</file>
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>ERROR</level>
        </filter>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>
                ${application.system.logging.path}/${component.gateway.name}/common-error.log.%d{yyyy-MM-dd}
            </fileNamePattern>
            <maxHistory>${application.system.logging.max.history}</maxHistory>
        </rollingPolicy>
        <encoder>
            <Pattern>${spring.cloud.antfin.customized.patternlayout}</Pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <appender name="COUNT-ERROR-APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${application.system.logging.path}/${component.gateway.name}/count-error.log</file>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <!--不重复打印ERROR-->
            <level>ERROR</level>
            <onMatch>DENY</onMatch>
            <onMismatch>ACCEPT</onMismatch>
        </filter>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>
                ${application.system.logging.path}/${component.gateway.name}/count-error.log.%d{yyyy-MM-dd}
            </fileNamePattern>
            <maxHistory>${application.system.logging.max.history}</maxHistory>
        </rollingPolicy>
        <encoder>
            <Pattern>${spring.cloud.antfin.customized.patternlayout}</Pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <appender name="CORE-APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${application.system.logging.path}/${component.gateway.name}/core.log</file>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <!--不重复打印ERROR-->
            <level>ERROR</level>
            <onMatch>DENY</onMatch>
            <onMismatch>ACCEPT</onMismatch>
        </filter>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${application.system.logging.path}/${component.gateway.name}/core.log.%d{yyyy-MM-dd}
            </fileNamePattern>
            <maxHistory>${application.system.logging.max.history}</maxHistory>
        </rollingPolicy>
        <encoder>
            <Pattern>${spring.cloud.antfin.customized.patternlayout}</Pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <appender name="SECURITY-APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${application.system.logging.path}/${component.gateway.name}/security.log</file>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <!--不重复打印ERROR-->
            <level>ERROR</level>
            <onMatch>DENY</onMatch>
            <onMismatch>ACCEPT</onMismatch>
        </filter>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>
                ${application.system.logging.path}/${component.gateway.name}/security.log.%d{yyyy-MM-dd}
            </fileNamePattern>
            <maxHistory>${application.system.logging.max.history}</maxHistory>
        </rollingPolicy>
        <encoder>
            <Pattern>${spring.cloud.antfin.customized.patternlayout}</Pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <appender name="DIGEST-MESSAGE-APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>
            ${application.system.logging.path}/${component.gateway.name}/digest-message.log
        </file>
        　　　　　　
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>
                ${application.system.logging.path}/${component.gateway.name}/digest-message.log.%d{yyyy-MM-dd}
            </fileNamePattern>
            <maxHistory>${application.system.logging.max.history}</maxHistory>
        </rollingPolicy>
        <encoder>
            <Pattern>${spring.cloud.antfin.customized.patternlayout}</Pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <appender name="DIGEST-CACHE-APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>
            ${application.system.logging.path}/${component.gateway.name}/digest-cache.log
        </file>
        　　　　　　
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>
                ${application.system.logging.path}/${component.gateway.name}/digest-cache.log.%d{yyyy-MM-dd}
            </fileNamePattern>
            <maxHistory>${application.system.logging.max.history}</maxHistory>
        </rollingPolicy>
        <encoder>
            <Pattern>${spring.cloud.antfin.customized.patternlayout}</Pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <appender name="DIGEST-LIMIT-APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>
            ${application.system.logging.path}/${component.gateway.name}/digest-limit.log
        </file>
        　　　　　　
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>
                ${application.system.logging.path}/${component.gateway.name}/digest-limit.log.%d{yyyy-MM-dd}
            </fileNamePattern>
            <maxHistory>${application.system.logging.max.history}</maxHistory>
        </rollingPolicy>
        <encoder>
            <Pattern>${spring.cloud.antfin.customized.patternlayout}</Pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <appender name="DIGEST-HTTP-APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>
            ${application.system.logging.path}/${component.gateway.name}/digest-http.log
        </file>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>
                ${application.system.logging.path}/${component.gateway.name}/digest-http.log.%d{yyyy-MM-dd}
            </fileNamePattern>
            <maxHistory>${application.system.logging.max.history}</maxHistory>
        </rollingPolicy>
        <encoder>
            <Pattern>${spring.cloud.antfin.customized.patternlayout}</Pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <logger name="DIGEST-CACHE-LOGGER" level="${application.system.logging.level}" additivity="false">
        <appender-ref ref="DIGEST-CACHE-APPENDER"/>
        <appender-ref ref="CONSOLE-APPENDER"/>
    </logger>

    <logger name="DIGEST-LIMIT-LOGGER" level="${application.system.logging.level}" additivity="false">
        <appender-ref ref="DIGEST-LIMIT-APPENDER"/>
        <appender-ref ref="CONSOLE-APPENDER"/>
    </logger>

    <logger name="DIGEST-MESSAGE-LOGGER" level="${application.digest.message.logging.level}" additivity="false">
        <appender-ref ref="DIGEST-MESSAGE-APPENDER"/>
        <appender-ref ref="CONSOLE-APPENDER"/>
    </logger>

    <logger name="DIGEST-HTTP-LOGGER" level="info" additivity="false">
        <appender-ref ref="DIGEST-HTTP-APPENDER"/>
        <appender-ref ref="CONSOLE-APPENDER"/>
    </logger>

    <logger name="COMMON-ERROR-LOGGER" level="error" additivity="false">
        <appender-ref ref="COMMON-ERROR-APPENDER"/>
        <appender-ref ref="CONSOLE-APPENDER"/>
    </logger>

    <logger name="COUNT-ERROR-LOGGER" level="info" additivity="false">
        <appender-ref ref="COUNT-ERROR-APPENDER"/>
        <appender-ref ref="CONSOLE-APPENDER"/>
    </logger>

    <logger name="COMMON-MESSAGE-LOGGER" additivity="false">
        <appender-ref ref="CORE-APPENDER"/>
        <appender-ref ref="CONSOLE-APPENDER"/>
    </logger>

    <logger name="COMMON-CERT-ALGORITHM" additivity="false">
        <appender-ref ref="SECURITY-APPENDER"/>
        <appender-ref ref="CORE-APPENDER"/>
        <appender-ref ref="CONSOLE-APPENDER"/>
    </logger>

    <!--todo 定义你的包路径-->
    <logger name="com.github.loadup.components.gateway" level="${application.system.logging.level}" additivity="false">
        <appender-ref ref="CONSOLE-APPENDER"/>
        <appender-ref ref="CORE-APPENDER"/>
        <appender-ref ref="COMMON-ERROR-APPENDER"/>
    </logger>

    <root level="${application.system.logging.level}">
        <appender-ref ref="CONSOLE-APPENDER"/>
        <appender-ref ref="COMMON-ERROR-APPENDER"/>
    </root>

</configuration>