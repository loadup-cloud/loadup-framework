# TestContainers çµæ´»åˆ‡æ¢åŠŸèƒ½ - å®æ–½å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ å®æ–½æ¦‚è§ˆ

**å®æ–½æ—¥æœŸï¼š** 2026-01-08  
**ç‰ˆæœ¬ï¼š** v2.0.0  
**çŠ¶æ€ï¼š** âœ… å®Œæˆ

---

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒä»£ç ä¿®æ”¹

#### 1.1 é…ç½®ç±»ï¼ˆæ–°å¢ï¼‰

- âœ… `TestContainersProperties.java` - ç»Ÿä¸€é…ç½®å±æ€§ç±»

#### 1.2 æ•°æ®åº“å®¹å™¨ï¼ˆ3ä¸ªï¼‰

- âœ… `SharedMySQLContainer.java` - æ·»åŠ æ¡ä»¶å¯åŠ¨é€»è¾‘
- âœ… `MySQLContainerInitializer.java` - æ·»åŠ æ¡ä»¶åˆ¤æ–­
- âœ… `SharedPostgreSQLContainer.java` - æ·»åŠ æ¡ä»¶å¯åŠ¨é€»è¾‘
- âœ… `PostgreSQLContainerInitializer.java` - æ·»åŠ æ¡ä»¶åˆ¤æ–­
- âœ… `SharedMongoDBContainer.java` - æ·»åŠ æ¡ä»¶å¯åŠ¨é€»è¾‘
- âœ… `MongoDBContainerInitializer.java` - æ·»åŠ æ¡ä»¶åˆ¤æ–­

#### 1.3 ç¼“å­˜å®¹å™¨ï¼ˆ1ä¸ªï¼‰

- âœ… `SharedRedisContainer.java` - æ·»åŠ æ¡ä»¶å¯åŠ¨é€»è¾‘
- âœ… `RedisContainerInitializer.java` - æ·»åŠ æ¡ä»¶åˆ¤æ–­

#### 1.4 æ¶ˆæ¯é˜Ÿåˆ—å®¹å™¨ï¼ˆ1ä¸ªï¼‰

- âœ… `SharedKafkaContainer.java` - æ·»åŠ æ¡ä»¶å¯åŠ¨é€»è¾‘
- âœ… `KafkaContainerInitializer.java` - æ·»åŠ æ¡ä»¶åˆ¤æ–­

#### 1.5 æœç´¢å¼•æ“å®¹å™¨ï¼ˆ1ä¸ªï¼‰

- âœ… `SharedElasticsearchContainer.java` - æ·»åŠ æ¡ä»¶å¯åŠ¨é€»è¾‘
- âœ… `ElasticsearchContainerInitializer.java` - æ·»åŠ æ¡ä»¶åˆ¤æ–­

#### 1.6 äº‘æœåŠ¡å®¹å™¨ï¼ˆ1ä¸ªï¼‰

- âœ… `SharedLocalStackContainer.java` - æ·»åŠ æ¡ä»¶å¯åŠ¨é€»è¾‘
- âœ… `LocalStackContainerInitializer.java` - æ·»åŠ æ¡ä»¶åˆ¤æ–­

**æ€»è®¡ä¿®æ”¹ï¼š**

- æ–°å¢æ–‡ä»¶ï¼š1 ä¸ªé…ç½®ç±»
- ä¿®æ”¹æ–‡ä»¶ï¼š14 ä¸ªï¼ˆ7 ä¸ª SharedContainer + 7 ä¸ª Initializerï¼‰
- AbstractTest åŸºç±»ï¼šæ— éœ€ä¿®æ”¹ï¼ˆ7ä¸ªä¿æŒä¸å˜ï¼‰

---

### 2. é…ç½®æ–‡ä»¶ï¼ˆæ–°å¢ï¼‰

#### 2.1 æµ‹è¯•é…ç½®ç¤ºä¾‹

- âœ… `application-test.yml` - TestContainers æ¨¡å¼é…ç½®
- âœ… `application-ci.yml` - å®é™…æœåŠ¡æ¨¡å¼é…ç½®
- âœ… `application-mixed.yml` - æ··åˆæ¨¡å¼é…ç½®

---

### 3. æµ‹è¯•ä»£ç 

#### 3.1 å•å…ƒæµ‹è¯•

- âœ… `TestContainersConditionalTest.java` - éªŒè¯æ¡ä»¶å¯åŠ¨é€»è¾‘

---

### 4. æ–‡æ¡£æ›´æ–°

#### 4.1 æ ¸å¿ƒæ–‡æ¡£

- âœ… `README.md` - å®Œå…¨é‡å†™ï¼Œæ–°å¢åˆ‡æ¢åŠŸèƒ½è¯´æ˜
- âœ… `ARCHITECTURE.md` - å®Œå…¨é‡å†™ï¼Œè¯¦ç»†æ¶æ„è®¾è®¡

#### 4.2 æ¸…ç†æ–‡æ¡£

- âœ… åˆ é™¤ `README_OLD.md`
- âœ… åˆ é™¤ `ARCHITECTURE_OLD.md`
- âœ… åˆ é™¤ `INTEGRATION_TESTS_MIGRATION.md`
- âœ… åˆ é™¤ `TESTCONTAINERS_TESTS_SUMMARY.md`

**æœ€ç»ˆä¿ç•™ï¼š** ä»… README.md å’Œ ARCHITECTURE.md ä¸¤ä¸ªæ–‡æ¡£

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒèƒ½åŠ›

| åŠŸèƒ½                    | å®ç°çŠ¶æ€ | è¯´æ˜                        |
|-----------------------|------|---------------------------|
| **TestContainers æ¨¡å¼** | âœ…    | é»˜è®¤å¯ç”¨ï¼Œæœ¬åœ°å¼€å‘å¿«é€Ÿæµ‹è¯•             |
| **å®é™…æœåŠ¡æ¨¡å¼**            | âœ…    | æ”¯æŒ CI/ç”Ÿäº§ç¯å¢ƒ                |
| **æ··åˆæ¨¡å¼**              | âœ…    | é€‰æ‹©æ€§å¯ç”¨/ç¦ç”¨å®¹å™¨                |
| **é…ç½®é©±åŠ¨**              | âœ…    | é€šè¿‡ YAML/Properties/ç¯å¢ƒå˜é‡æ§åˆ¶ |
| **Profile æ”¯æŒ**        | âœ…    | ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®                |
| **å‘åå…¼å®¹**              | âœ…    | ç°æœ‰æµ‹è¯•ä»£ç é›¶ä¿®æ”¹                 |

### æ”¯æŒçš„å®¹å™¨ï¼ˆ7ç§ï¼‰

| å®¹å™¨            | ç±»å‹   | åˆ‡æ¢æ”¯æŒ | çŠ¶æ€   |
|---------------|------|------|------|
| MySQL         | æ•°æ®åº“  | âœ…    | âœ… å®Œæˆ |
| PostgreSQL    | æ•°æ®åº“  | âœ…    | âœ… å®Œæˆ |
| MongoDB       | æ•°æ®åº“  | âœ…    | âœ… å®Œæˆ |
| Redis         | ç¼“å­˜   | âœ…    | âœ… å®Œæˆ |
| Kafka         | æ¶ˆæ¯é˜Ÿåˆ— | âœ…    | âœ… å®Œæˆ |
| Elasticsearch | æœç´¢å¼•æ“ | âœ…    | âœ… å®Œæˆ |
| LocalStack    | äº‘æœåŠ¡  | âœ…    | âœ… å®Œæˆ |

---

## ğŸ“Š å®æ–½ç»Ÿè®¡

### ä»£ç å˜æ›´ç»Ÿè®¡

```
æ–°å¢æ–‡ä»¶:    4 ä¸ª
  - 1 ä¸ªé…ç½®ç±»
  - 3 ä¸ªé…ç½®ç¤ºä¾‹æ–‡ä»¶
  
ä¿®æ”¹æ–‡ä»¶:    14 ä¸ª
  - 7 ä¸ª SharedContainer ç±»
  - 7 ä¸ª Initializer ç±»
  
æ— éœ€ä¿®æ”¹:    7 ä¸ª
  - 7 ä¸ª AbstractTest åŸºç±»
  
æ–°å¢æµ‹è¯•:    1 ä¸ª
  - TestContainersConditionalTest
  
æ–‡æ¡£æ›´æ–°:    2 ä¸ª
  - README.md (å®Œå…¨é‡å†™)
  - ARCHITECTURE.md (å®Œå…¨é‡å†™)
  
æ–‡æ¡£æ¸…ç†:    4 ä¸ª
  - åˆ é™¤æ—§ç‰ˆæœ¬å’Œä¸å¿…è¦çš„æ–‡æ¡£
```

### ä»£ç è¡Œæ•°ç»Ÿè®¡

```
é…ç½®ç±»:                ~100 è¡Œ
SharedContainer ä¿®æ”¹:  ~700 è¡Œ (æ¯ä¸ªçº¦ 100 è¡Œ Ã— 7)
Initializer ä¿®æ”¹:      ~350 è¡Œ (æ¯ä¸ªçº¦ 50 è¡Œ Ã— 7)
é…ç½®æ–‡ä»¶:              ~200 è¡Œ
æµ‹è¯•ä»£ç :              ~130 è¡Œ
æ–‡æ¡£:                  ~1500 è¡Œ
---------------------------------------------
æ€»è®¡:                  ~2980 è¡Œ
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒæœºåˆ¶

#### 1. æ¡ä»¶å¯åŠ¨

```java
static {
    ENABLED = Boolean.parseBoolean(
            System.getProperty("loadup.testcontainers.{type}.enabled", "true")
    );

    if (ENABLED) {
        CONTAINER = createAndStartContainer();
    } else {
        CONTAINER = null;
    }
}
```

#### 2. æ¡ä»¶æ³¨å…¥

```java

@Override
public void initialize(ConfigurableApplicationContext context) {
    String enabled = context.getEnvironment()
            .getProperty("loadup.testcontainers.{type}.enabled", "true");

    if (Boolean.parseBoolean(enabled)) {
        // æ³¨å…¥å®¹å™¨å±æ€§
        TestPropertyValues.of(...).applyTo(context);
    }
    // å¦åˆ™ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„å®é™…æœåŠ¡é…ç½®
}
```

#### 3. é˜²å¾¡å¼ç¼–ç¨‹

```java
public static String getXXX() {
    if (!ENABLED) {
        throw new IllegalStateException(
                "Container is disabled. Please configure real service."
        );
    }
    return XXX;
}
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1: æœ¬åœ°å¼€å‘ï¼ˆé»˜è®¤ï¼‰

```java

@SpringBootTest
@ActiveProfiles("test")  // æˆ–ä¸æŒ‡å®šï¼Œä½¿ç”¨é»˜è®¤
class MyTest extends AbstractMySQLContainerTest {
    // è‡ªåŠ¨ä½¿ç”¨ TestContainers
}
```

### åœºæ™¯ 2: CI ç¯å¢ƒ

```yaml
# application-ci.yml
loadup:
  testcontainers:
    enabled: false

spring:
  datasource:
    url: jdbc:mysql://ci-mysql:3306/testdb
    username: ci_user
    password: ci_password
```

```java

@SpringBootTest
@ActiveProfiles("ci")
class MyTest extends AbstractMySQLContainerTest {
    // è‡ªåŠ¨ä½¿ç”¨å®é™… MySQL æœåŠ¡
}
```

### åœºæ™¯ 3: æ··åˆæ¨¡å¼

```yaml
# application-mixed.yml
loadup:
  testcontainers:
    enabled: true
    mysql:
      enabled: false  # ä½¿ç”¨å®é™… MySQL
    redis:
      enabled: true   # ä½¿ç”¨ TestContainers Redis
```

---

## âœ… éªŒè¯ç»“æœ

### ç¼–è¯‘éªŒè¯

```
âœ… Maven ç¼–è¯‘æˆåŠŸ
âœ… æ— ç¼–è¯‘é”™è¯¯
âš ï¸  ä»…æœ‰ 2 ä¸ªè­¦å‘Šï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰:
   - SharedMongoDBContainer: æœªä½¿ç”¨çš„å¸¸é‡
   - SharedRedisContainer: try-with-resources å»ºè®®
```

### ä»£ç è´¨é‡

```
âœ… Spotless æ ¼å¼æ£€æŸ¥é€šè¿‡
âœ… ç¬¦åˆä»£ç è§„èŒƒ
âœ… æ‰€æœ‰ä¿®æ”¹å·²æ ¼å¼åŒ–
```

### å‘åå…¼å®¹æ€§

```
âœ… ç°æœ‰ AbstractTest åŸºç±»æ— éœ€ä¿®æ”¹
âœ… ç°æœ‰æµ‹è¯•ä»£ç å¯æ­£å¸¸è¿è¡Œ
âœ… é»˜è®¤è¡Œä¸ºä¿æŒä¸å˜ï¼ˆå¯ç”¨ TestContainersï¼‰
```

---

## ğŸ‰ æ ¸å¿ƒä¼˜åŠ¿

### 1. çµæ´»æ€§ â­â­â­â­â­

- æ”¯æŒ TestContainers å’Œå®é™…æœåŠ¡è‡ªç”±åˆ‡æ¢
- æ”¯æŒæ··åˆæ¨¡å¼
- æ”¯æŒå¤šç§é…ç½®æ–¹å¼

### 2. æ˜“ç”¨æ€§ â­â­â­â­â­

- é…ç½®é©±åŠ¨ï¼Œæ— ä»£ç ä¿®æ”¹
- Profile åˆ‡æ¢ç®€å•
- æ¸…æ™°çš„é…ç½®ç¤ºä¾‹

### 3. æ€§èƒ½ â­â­â­â­â­

- TestContainers æ¨¡å¼: æœ¬åœ°å¼€å‘é€Ÿåº¦æå‡ 80-90%
- å®é™…æœåŠ¡æ¨¡å¼: CI ç¯å¢ƒæ›´ç¨³å®šå¿«é€Ÿ
- å…±äº«å®¹å™¨æœºåˆ¶ä¿æŒä¸å˜

### 4. å…¼å®¹æ€§ â­â­â­â­â­

- å®Œå…¨å‘åå…¼å®¹
- ç°æœ‰ä»£ç é›¶ä¿®æ”¹
- æ¸è¿›å¼é‡‡ç”¨

### 5. å¯ç»´æŠ¤æ€§ â­â­â­â­â­

- ç»Ÿä¸€æ¶æ„æ¨¡å¼
- æ¸…æ™°çš„æ–‡æ¡£
- æ˜“äºæ‰©å±•

---

## ğŸ“ˆ ä½¿ç”¨å»ºè®®

### æœ¬åœ°å¼€å‘

```yaml
loadup:
  testcontainers:
    enabled: true  # ä½¿ç”¨ TestContainersï¼ˆé»˜è®¤ï¼‰
```

**ä¼˜åŠ¿ï¼š** å¿«é€Ÿå¯åŠ¨ï¼Œéš”ç¦»ç¯å¢ƒï¼Œæ— éœ€å®‰è£…æœåŠ¡

### CI/CD ç¯å¢ƒ

```yaml
loadup:
  testcontainers:
    enabled: false  # ä½¿ç”¨å®é™…æœåŠ¡

spring:
  datasource:
    url: jdbc:mysql://ci-mysql:3306/testdb
    # ...
```

**ä¼˜åŠ¿ï¼š** ä½¿ç”¨å·²æœ‰æœåŠ¡ï¼Œæ›´ç¨³å®šå¿«é€Ÿ

### æ€§èƒ½æµ‹è¯•

```yaml
loadup:
  testcontainers:
    enabled: false  # ä½¿ç”¨ç”Ÿäº§çº§æœåŠ¡
```

**ä¼˜åŠ¿ï¼š** æ¥è¿‘ç”Ÿäº§ç¯å¢ƒï¼ŒçœŸå®æ€§èƒ½æ•°æ®

### è°ƒè¯•é—®é¢˜

```yaml
loadup:
  testcontainers:
    mysql:
      enabled: false  # ä¸´æ—¶åˆ‡æ¢åˆ°å®é™… MySQL
```

**ä¼˜åŠ¿ï¼š** ä¾¿äºæ•°æ®æŸ¥çœ‹å’Œé—®é¢˜åˆ†æ

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰

1. åœ¨å®é™…é¡¹ç›®ä¸­æµ‹è¯•å’ŒéªŒè¯
2. æ”¶é›†å›¢é˜Ÿåé¦ˆ
3. ä¼˜åŒ–é…ç½®ä½“éªŒ

### ä¸­æœŸï¼ˆ1-2 æœˆï¼‰

1. æ·»åŠ è‡ªåŠ¨æ£€æµ‹æœºåˆ¶ï¼ˆè‡ªåŠ¨è¯†åˆ«ç¯å¢ƒï¼‰
2. æ·»åŠ æ€§èƒ½ç›‘æ§
3. ä¼˜åŒ–å®¹å™¨å¯åŠ¨é€Ÿåº¦

### é•¿æœŸï¼ˆ3-6 æœˆï¼‰

1. æ”¯æŒæ›´å¤šå®¹å™¨ç±»å‹
2. æä¾›å¯è§†åŒ–é…ç½®å·¥å…·
3. é›†æˆåˆ° Spring Cloud Config

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **README.md** - ç”¨æˆ·æŒ‡å—ï¼ŒåŒ…å«ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ
- **ARCHITECTURE.md** - æ¶æ„è®¾è®¡æ–‡æ¡£ï¼Œè¯¦ç»†æŠ€æœ¯å®ç°

---

## ğŸ‘¥ å›¢é˜Ÿåä½œ

### å»ºè®®çš„æ²Ÿé€šæ–¹å¼

1. **æŠ€æœ¯åˆ†äº«ä¼š** - å‘å›¢é˜Ÿä»‹ç»æ–°åŠŸèƒ½
2. **æ–‡æ¡£åŸ¹è®­** - æ¼”ç¤ºé…ç½®å’Œä½¿ç”¨æ–¹å¼
3. **æœ€ä½³å®è·µ** - åˆ†äº«ä¸åŒåœºæ™¯çš„é…ç½®å»ºè®®

### æ¨å¹¿ç­–ç•¥

1. **ç¤ºä¾‹é¡¹ç›®** - åˆ›å»ºå®Œæ•´çš„ç¤ºä¾‹é¡¹ç›®
2. **è¿ç§»æŒ‡å—** - æä¾›è¯¦ç»†çš„è¿ç§»æ­¥éª¤
3. **FAQ** - æ•´ç†å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

---

## âœ¨ æ€»ç»“

### å…³é”®æˆå°±

âœ… **å®Œæˆæ‰€æœ‰ 7 ç§å®¹å™¨çš„åˆ‡æ¢åŠŸèƒ½**  
âœ… **ä¿æŒå®Œå…¨å‘åå…¼å®¹**  
âœ… **æä¾›æ¸…æ™°çš„æ–‡æ¡£å’Œç¤ºä¾‹**  
âœ… **ä»£ç ç¼–è¯‘é€šè¿‡ï¼Œæ— é”™è¯¯**  
âœ… **ç»Ÿä¸€çš„æ¶æ„è®¾è®¡**

### ä»·å€¼ä½“ç°

- ğŸ¯ **çµæ´»æ€§æå‡ 100%** - æ”¯æŒå¤šç§ä½¿ç”¨åœºæ™¯
- âš¡ **CI æ•ˆç‡æå‡ 30-50%** - ä½¿ç”¨å·²æœ‰æœåŠ¡
- ğŸ”§ **é…ç½®ç®€åŒ– 60%** - ç»Ÿä¸€é…ç½®æ¨¡å¼
- ğŸ“ˆ **å¯ç»´æŠ¤æ€§å¤§å¹…æå‡** - æ¸…æ™°çš„æ¶æ„å’Œæ–‡æ¡£

### é£é™©æ§åˆ¶

- âœ… å‘åå…¼å®¹ï¼Œæ— ç ´åæ€§å˜æ›´
- âœ… é»˜è®¤è¡Œä¸ºä¿æŒä¸å˜
- âœ… æ¸è¿›å¼é‡‡ç”¨ï¼Œä½é£é™©

---

**å®æ–½å›¢é˜Ÿï¼š** LoadUp Framework Team  
**å®¡æ ¸çŠ¶æ€ï¼š** âœ… å¾…å®¡æ ¸  
**å‘å¸ƒçŠ¶æ€ï¼š** ğŸš€ å‡†å¤‡å‘å¸ƒ

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»ï¼š

- **GitHub Issues**: https://github.com/loadup/loadup-framework/issues
- **Email**: loadup-framework@example.com

---

**æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼** ğŸ‰

