
---
description: LoadUp Framework ä»£ç è§„èŒƒä¸æ¶æ„çº¦æŸï¼Œé€‚ç”¨äºæ‰€æœ‰ Java ä»£ç ç”Ÿæˆå’Œä¿®æ”¹
globs: ["**/*.java", "**/pom.xml", "**/*.yml", "**/*.yaml"]
alwaysApply: true
---

# LoadUp Framework â€” Cursor ä»£ç è§„èŒƒ

## âš¡ æœ€é«˜ä¼˜å…ˆçº§è§„åˆ™ï¼ˆè¿ååˆ™ç«‹å³æé†’ï¼‰

1. **ğŸš« ä¸ç”Ÿæˆ License æ–‡ä»¶å¤´** â€” Java æ–‡ä»¶ä¸å¾—åŒ…å« `/*- #%L ... #L% */` å—ï¼ŒCI é˜¶æ®µç”± `license-maven-plugin` ç»Ÿä¸€æ’å…¥ï¼ˆLicense: GPL-3.0ï¼‰
2. **ğŸš« ä¸ç”Ÿæˆ Controller/adapter å±‚** â€” é€šè¿‡ `bean://beanName:method` Gateway åè®®ç›´æ¥è°ƒç”¨ App Serviceï¼Œæ— éœ€ `@RestController`
3. **ğŸš« é›†æˆæµ‹è¯•ä¸ç”¨ `@MockBean`** â€” ä½¿ç”¨ `@EnableTestContainers(ContainerType.MYSQL)` + `loadup-testify-spring-boot-starter`
4. **ğŸš« ä¸ç”¨ `@Autowired` å­—æ®µæ³¨å…¥** â€” å…¨éƒ¨ä½¿ç”¨æ„é€ å™¨æ³¨å…¥ï¼ˆ`@RequiredArgsConstructor`ï¼‰
5. **ğŸš« ä¸æ‹¼æ¥ SQL å­—ç¬¦ä¸²** â€” ä½¿ç”¨ MyBatis-Flex `QueryWrapper`

---

## æŠ€æœ¯æ ˆ

- Java **21** | Spring Boot **3.4.3** | MyBatis-Flex **1.11.5**
- æ•°æ®åº“ï¼šMySQL 8.0+ | æœ¬åœ°ç¼“å­˜ï¼šCaffeine | åˆ†å¸ƒå¼ç¼“å­˜ï¼šRedis (Redisson)
- æµ‹è¯•ï¼šJUnit 5 + `loadup-testify-spring-boot-starter` + `loadup-components-testcontainers`
- æ„å»ºï¼šMaven | ä»£ç æ ¼å¼åŒ–ï¼šSpotless (Palantir Java Format)
- Licenseï¼šGPL-3.0

---

## é¡¹ç›®ç»“æ„ï¼ˆMonorepoï¼‰

```
loadup-parent/
â”œâ”€â”€ loadup-dependencies/        # BOMï¼Œæ‰€æœ‰ä¾èµ–ç‰ˆæœ¬ä»æ­¤å¤„ç®¡ç†
â”œâ”€â”€ commons/                    # é€šç”¨åŸºç¡€ï¼ˆæ— ä¸šåŠ¡ï¼‰
â”‚   â”œâ”€â”€ loadup-commons-api/
â”‚   â”œâ”€â”€ loadup-commons-dto/     # Result<T>, PageDTO
â”‚   â””â”€â”€ loadup-commons-util/
â”œâ”€â”€ components/                 # å¯å¤ç”¨æŠ€æœ¯ç»„ä»¶ï¼ˆæ— ä¸šåŠ¡ï¼‰
â”‚   â”œâ”€â”€ loadup-components-authorization/   # @RequirePermission
â”‚   â”œâ”€â”€ loadup-components-cache/           # Caffeine/Redis binder
â”‚   â”œâ”€â”€ loadup-components-database/        # MyBatis-Flex, å¤šç§Ÿæˆ·
â”‚   â”œâ”€â”€ loadup-components-dfs/             # æ–‡ä»¶å­˜å‚¨
â”‚   â”œâ”€â”€ loadup-components-flyway/
â”‚   â”œâ”€â”€ loadup-components-globalunique/    # å…¨å±€å¹‚ç­‰
â”‚   â”œâ”€â”€ loadup-components-gotone/          # æ¶ˆæ¯é€šçŸ¥ (Email/SMS/Push/Webhook)
â”‚   â”œâ”€â”€ loadup-components-retrytask/       # é‡è¯•ä»»åŠ¡
â”‚   â”œâ”€â”€ loadup-components-scheduler/
â”‚   â”œâ”€â”€ loadup-components-signature/       # RSA/DSA/MD5 ç­¾å
â”‚   â”œâ”€â”€ loadup-components-testcontainers/  # æµ‹è¯•å®¹å™¨
â”‚   â””â”€â”€ loadup-components-tracer/          # OpenTelemetry
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ loadup-gateway/         # è‡ªç ” API ç½‘å…³ï¼ˆSpring MVCï¼Œé WebFluxï¼‰
â”‚   â”‚   â”œâ”€â”€ loadup-gateway-facade/   # SPIã€Modelã€é…ç½®å±æ€§
â”‚   â”‚   â”œâ”€â”€ loadup-gateway-core/     # è·¯ç”±è§£æã€Action è´£ä»»é“¾
â”‚   â”‚   â””â”€â”€ loadup-gateway-starter/  # AutoConfiguration
â”‚   â””â”€â”€ loadup-testify/         # æµ‹è¯•æ¡†æ¶è„šæ‰‹æ¶
â”œâ”€â”€ modules/                    # ä¸šåŠ¡æ¨¡å—ï¼ˆCOLA 4.0ï¼Œæ—  adapter å±‚ï¼‰
â”‚   â”œâ”€â”€ loadup-modules-upms/    # ç”¨æˆ·æƒé™ç®¡ç†
â”‚   â””â”€â”€ loadup-modules-config/  # é…ç½®ç®¡ç†ï¼ˆç³»ç»Ÿå‚æ•°+æ•°æ®å­—å…¸ï¼‰
â””â”€â”€ loadup-application/         # SpringBoot å¯åŠ¨å™¨
```

---

## æ¨¡å—ä¾èµ–æ–¹å‘ï¼ˆä¸¥æ ¼å•å‘ï¼‰

```
dependencies â†’ commons â†’ components â†’ modules â†’ application
gateway: ä¾èµ– commons/componentsï¼Œä¸è¢« modules/application ä¾èµ–
testify: ä»… test scope
modules ä¹‹é—´ï¼šç¦æ­¢æ¨ªå‘ä¾èµ–
```

## ä¸šåŠ¡æ¨¡å—åˆ†å±‚ï¼ˆCOLA 4.0ï¼Œæ—  adapterï¼‰

```
loadup-modules-{xxx}/
â”œâ”€â”€ -client/         # å¯¹å¤– DTO + Commandï¼ˆå¯è¢«å…¶ä»–æ¨¡å—ä¾èµ–ï¼‰
â”œâ”€â”€ -domain/         # çº¯ DDD æ¨¡å‹ï¼ˆPOJOï¼‰+ Gateway æ¥å£ + æšä¸¾
â”‚                    # âš ï¸ æ—  Spring æ³¨è§£ï¼Œæ—  @Tableï¼Œæ—  ORM ä¾èµ–
â”œâ”€â”€ -infrastructure/ # XxxDO extends BaseDOã€Mapperã€GatewayImplã€æœ¬åœ°ç¼“å­˜
â”œâ”€â”€ -app/            # @Service ä¸šåŠ¡ç¼–æ’ + AutoConfiguration
â””â”€â”€ -test/           # æµ‹è¯•ï¼ˆparent æŒ‡å‘æ ¹ loadup-parent pomï¼‰
```

| å±‚ | æ”¾ä»€ä¹ˆ | ç¦æ­¢ |
|----|--------|------|
| client | DTOã€Commandã€Query | ä¸šåŠ¡é€»è¾‘ã€DB æ³¨è§£ |
| domain | POJO æ¨¡å‹ã€Gateway æ¥å£ã€æšä¸¾ | `@Table`ã€`@Service`ã€ä»»ä½•æ¡†æ¶æ³¨è§£ |
| infrastructure | `XxxDO extends BaseDO`ã€Mapperã€GatewayImplã€Cache | ä¸šåŠ¡é€»è¾‘ |
| app | `@Service`ã€AutoConfiguration | ç›´æ¥æ“ä½œ DB |

---

## Gateway é›†æˆï¼ˆå–ä»£ Controllerï¼‰

```yaml
# application.yml
loadup:
  gateway:
    routes:
      - path: /api/v1/config/list
        method: POST
        target: "bean://configItemService:listAll"   # ç›´æ¥è°ƒç”¨ Spring Bean
        securityCode: "default"                       # JWT è®¤è¯
      - path: /api/v1/config/create
        method: POST
        target: "bean://configItemService:create"
        securityCode: "default"
      - path: /api/v1/public/dict
        method: POST
        target: "bean://dictService:getDictData"
        securityCode: "OFF"                           # å…³é—­è®¤è¯
```

| securityCode | å«ä¹‰ |
|---|---|
| `OFF` | å…³é—­æ‰€æœ‰å®‰å…¨æ ¡éªŒ |
| `default` | JWT Token éªŒè¯ |
| `hmac` | HMAC ç­¾åéªŒç­¾ |
| è‡ªå®šä¹‰ | å®ç° `SecurityStrategy` SPI |

---

## åŒ…å‘½åè§„èŒƒ

ä¸šåŠ¡æ¨¡å—æ ¹åŒ…ï¼š`io.github.loadup.modules.{mod}`

| å­æ¨¡å— | å±‚ | åŒ…è·¯å¾„ |
|--------|-----|--------|
| `{mod}-client` | DTO | `io.github.loadup.modules.{mod}.client.dto` |
| `{mod}-client` | Command | `io.github.loadup.modules.{mod}.client.command` |
| `{mod}-client` | Query | `io.github.loadup.modules.{mod}.client.query` |
| `{mod}-client` | Serviceæ¥å£ | `io.github.loadup.modules.{mod}.client.service` |
| `{mod}-domain` | modelï¼ˆPOJOï¼‰| `io.github.loadup.modules.{mod}.domain.model` |
| `{mod}-domain` | gateway æ¥å£ | `io.github.loadup.modules.{mod}.domain.gateway` |
| `{mod}-domain` | enums | `io.github.loadup.modules.{mod}.domain.enums` |
| `{mod}-domain` | valueobject | `io.github.loadup.modules.{mod}.domain.valueobject` |
| `{mod}-infrastructure` | DO å®ä½“ | `io.github.loadup.modules.{mod}.infrastructure.dataobject` |
| `{mod}-infrastructure` | Mapperï¼ˆAPTï¼‰| `io.github.loadup.modules.{mod}.infrastructure.mapper` |
| `{mod}-infrastructure` | Tables/TableDefï¼ˆAPTï¼‰| `io.github.loadup.modules.{mod}.infrastructure.dataobject.table` |
| `{mod}-infrastructure` | MapStruct Converter | `io.github.loadup.modules.{mod}.infrastructure.converter` |
| `{mod}-infrastructure` | GatewayImpl | `io.github.loadup.modules.{mod}.infrastructure.repository` |
| `{mod}-infrastructure` | æœ¬åœ°ç¼“å­˜ | `io.github.loadup.modules.{mod}.infrastructure.cache` |
| `{mod}-app` | @Service | `io.github.loadup.modules.{mod}.app.service` |
| `{mod}-app` | AutoConfiguration | `io.github.loadup.modules.{mod}.app.autoconfigure` |

---

## å‘½åè§„èŒƒ

| ç±»å‹ | è§„åˆ™ | ç¤ºä¾‹ |
|------|------|------|
| æ•°æ®åº“æ˜ å°„å¯¹è±¡ | `XxxDO` | `ConfigItemDO` |
| å¯¹å¤– DTO | `XxxDTO` | `ConfigItemDTO` |
| åˆ›å»ºå‘½ä»¤ | `XxxCreateCommand` | `ConfigItemCreateCommand` |
| æ›´æ–°å‘½ä»¤ | `XxxUpdateCommand` | `ConfigItemUpdateCommand` |
| Gateway æ¥å£ | `XxxGateway` | `ConfigItemGateway` |
| Gateway å®ç° | `XxxGatewayImpl` | `ConfigItemGatewayImpl` |
| Mapper | `XxxMapper` | `ConfigItemMapper` |
| Service | `XxxService`ï¼ˆæ—  impl åˆ†ç¦»ï¼‰ | `ConfigItemService` |
| æœ¬åœ°ç¼“å­˜ | `XxxLocalCache` | `ConfigLocalCache` |
| AutoConfig | `XxxModuleAutoConfiguration` | `ConfigModuleAutoConfiguration` |
| é›†æˆæµ‹è¯• | `XxxServiceIT` | `ConfigItemServiceIT` |
| å•å…ƒæµ‹è¯• | `XxxServiceTest` | `ConfigItemServiceTest` |

---

## ä»£ç æ¨¡æ¿

### DO å®ä½“ï¼ˆinfrastructure å±‚ï¼Œç»§æ‰¿ BaseDOï¼‰

> âš ï¸ DO æ”¾ infrastructure å±‚ï¼›domain å±‚åªæ”¾çº¯ POJO + Gateway æ¥å£ï¼Œç¦æ­¢ `@Table`ã€‚
> æ‰€æœ‰ DO **å¿…é¡»ç»§æ‰¿ `BaseDO`**ï¼Œä½¿ç”¨ `@Data` + `@NoArgsConstructor` + `@AllArgsConstructor` + `@EqualsAndHashCode(callSuper = true)`ã€‚
> **ä¸ä½¿ç”¨ `@Builder` / `@SuperBuilder`**ï¼ˆMyBatis-Flex é€šè¿‡åå°„å¡«å……ï¼Œæ— éœ€ builderï¼‰ã€‚
> `BaseDO` å·²æä¾› `id`ã€`createdAt`ã€`updatedAt`ã€`tenantId`ã€`deleted`ï¼Œå­ç±»ä¸å¾—é‡å¤å®šä¹‰ã€‚

```java
package io.github.loadup.modules.{mod}.entity;

import com.mybatisflex.annotation.Table;
import io.github.loadup.commons.dataobject.BaseDO;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
@EqualsAndHashCode(callSuper = true)
@Table("{table_name}")
public class {Entity}DO extends BaseDO {

    // ä¸šåŠ¡å­—æ®µï¼ˆid/createdAt/updatedAt/tenantId/deleted å·²åœ¨ BaseDO ä¸­ï¼Œå‹¿é‡å¤å®šä¹‰ï¼‰
    private String createdBy;
    private String updatedBy;
    // ... å…¶ä»–ä¸šåŠ¡å­—æ®µ
}
```

### Gateway æ¥å£
```java
package io.github.loadup.modules.{mod}.gateway;

import java.util.List;
import java.util.Optional;

public interface {Entity}Gateway {
    Optional<{Entity}DO> findById(String id);
    List<{Entity}DO> findAll();
    void save({Entity}DO entity);
    void update({Entity}DO entity);
    void deleteById(String id);
    boolean existsById(String id);
}
```

### Tables è¡¨å­—æ®µå¼•ç”¨è§„èŒƒ

MyBatis-Flex APT ç”Ÿæˆ `Tables` èšåˆç±»ï¼ˆ`entity.table.Tables`ï¼‰å’Œ `XxxDOMapper`ï¼ˆ`entity.mapper` åŒ…ï¼‰ã€‚

- **è¡¨å­—æ®µå¼•ç”¨**ï¼šç»Ÿä¸€é€šè¿‡ `Tables.XXXX_DO` é™æ€å¯¼å…¥
- **ç¦æ­¢**ç›´æ¥å¼•ç”¨ `XxxDOTableDef.XXXX_D_O`

```java
// âœ… æ­£ç¡®
import static io.github.loadup.modules.{mod}.entity.table.Tables.CONFIG_ITEM_DO;
// ğŸš« ç¦æ­¢
import static io.github.loadup.modules.{mod}.entity.table.ConfigItemDOTableDef.CONFIG_ITEM_D_O;
```

### å¯¹è±¡è½¬æ¢ï¼ˆMapStructï¼‰

**DO â†” domain model è½¬æ¢å¿…é¡»ä½¿ç”¨ MapStruct**ï¼Œç¦æ­¢æ‰‹å†™ setter/builder é“¾ã€‚

```java
@Mapper(componentModel = MappingConstants.ComponentModel.SPRING)
public interface {Entity}Converter {
    {Entity} toModel({Entity}DO entity);
    {Entity}DO toEntity({Entity} model);
}
```

### Gateway å®ç°
```java
package io.github.loadup.modules.{mod}.infrastructure.repository;

import static io.github.loadup.modules.{mod}.infrastructure.dataobject.table.Tables.{ENTITY}_DO;

import com.mybatisflex.core.query.QueryWrapper;
import io.github.loadup.modules.{mod}.infrastructure.converter.{Entity}Converter;
import io.github.loadup.modules.{mod}.infrastructure.mapper.{Entity}DOMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Repository;

@Repository
@RequiredArgsConstructor
public class {Entity}GatewayImpl implements {Entity}Gateway {

    private final {Entity}DOMapper mapper;
    private final {Entity}Converter converter;

    @Override
    public Optional<{Entity}> findById(String id) {
        return Optional.ofNullable(
                mapper.selectOneByQuery(QueryWrapper.create().where({ENTITY}_DO.ID.eq(id))))
                .map(converter::toModel);
    }
    // ... å…¶ä»–æ–¹æ³•
}
```

### App Serviceï¼ˆç›´æ¥è¢« Gateway è°ƒç”¨ï¼‰
```java
package io.github.loadup.modules.{mod}.service;

import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

/**
 * {Entity} ä¸šåŠ¡æœåŠ¡ã€‚
 * é€šè¿‡ Gateway è·¯ç”±æš´éœ²ï¼šbean://{entity}Service:method
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class {Entity}Service {
    private final {Entity}Gateway gateway;

    public List<{Entity}DTO> listAll() {
        return gateway.findAll().stream().map(this::toDTO).toList();
    }

    @Transactional(rollbackFor = Exception.class)
    public String create(@Valid {Entity}CreateCommand cmd) {
        // 1. æ ¡éªŒå”¯ä¸€æ€§
        // 2. æ„å»º DOï¼ˆUUID IDï¼‰
        // 3. gateway.save(do)
        // 4. return id
    }

    private {Entity}DTO toDTO({Entity}DO item) { ... }
}
```

### AutoConfiguration
```java
package io.github.loadup.modules.{mod}.autoconfigure;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.autoconfigure.AutoConfiguration;
import org.springframework.context.annotation.ComponentScan;

@AutoConfiguration
@ComponentScan(basePackages = "io.github.loadup.modules.{mod}")
@MapperScan("io.github.loadup.modules.{mod}.mapper")
public class {Mod}ModuleAutoConfiguration {}
```

---

## æµ‹è¯•æ¨¡æ¿

### é›†æˆæµ‹è¯•ï¼ˆä½¿ç”¨ Testify + Testcontainersï¼‰
```java
package io.github.loadup.modules.{mod}.service;

import io.github.loadup.components.testcontainers.annotation.EnableTestContainers;
import io.github.loadup.components.testcontainers.annotation.ContainerType;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest
@EnableTestContainers(ContainerType.MYSQL)
class {Entity}ServiceIT {
    @Autowired
    private {Entity}Service service;

    @BeforeEach
    void setUp() { /* æ¸…ç†æµ‹è¯•æ•°æ® */ }

    @Test
    void create_shouldPersist_whenValidCommand() {
        var cmd = new {Entity}CreateCommand();
        // set fields...
        String id = service.create(cmd);
        assertThat(id).isNotBlank();
    }
}
```

### å•å…ƒæµ‹è¯•ï¼ˆçº¯é€»è¾‘ï¼Œæ—  DBï¼‰
```java
@ExtendWith(MockitoExtension.class)
class {Entity}ServiceTest {
    @Mock {Entity}Gateway gateway;
    @InjectMocks {Entity}Service service;

    @Test
    void create_shouldThrow_whenKeyExists() {
        when(gateway.existsByKey(any())).thenReturn(true);
        assertThatThrownBy(() -> service.create(new {Entity}CreateCommand()))
            .isInstanceOf(IllegalArgumentException.class);
    }
}
```

**æµ‹è¯• pom.xmlï¼ˆtest æ¨¡å—ï¼‰çš„ parent å¿…é¡»æŒ‡å‘æ ¹ loadup-parentï¼Œè€Œéæ¨¡å— pom**ï¼š
```xml
<parent>
    <groupId>io.github.loadup-cloud</groupId>
    <artifactId>loadup-parent</artifactId>
    <version>0.0.2-SNAPSHOT</version>
    <relativePath>../../../pom.xml</relativePath>
</parent>
```

### æµ‹è¯•æ¨¡å—ä¸‰æ–‡ä»¶è§„èŒƒ ğŸš«

**æ¯ä¸ª `*-test` æ¨¡å—çš„ `src/test/resources/` ç›®å½•ä¸‹å¿…é¡»åŒ…å«ä»¥ä¸‹ä¸‰ä¸ª yml æ–‡ä»¶ï¼š**

| æ–‡ä»¶ | ä½œç”¨ | å…³é”®é…ç½® |
|------|------|---------|
| `application.yml` | å…¥å£ï¼Œæ¿€æ´» `test` profile | `spring.profiles.active: test` |
| `application-test.yml` | æœ¬åœ°å¼€å‘é…ç½® | `testcontainers.reuse.enable: true`ï¼Œè¯¦ç»†æ—¥å¿—ï¼Œ`print-sql: true` |
| `application-ci.yml` | CI æµæ°´çº¿é…ç½® | `testcontainers.reuse.enable: false`ï¼Œç²¾ç®€è¿æ¥æ± ï¼Œ`print-sql: false` |

```yaml
# application.ymlï¼ˆå›ºå®šå†…å®¹ï¼Œä¸éšæ¨¡å—å˜åŒ–ï¼‰
spring:
  profiles:
    active: test
```

```yaml
# application-test.ymlï¼ˆæœ¬åœ°å¼€å‘ï¼‰
spring:
  application:
    name: loadup-{mod}-test
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      pool-name: LoadupTestPool
      minimum-idle: 2
      maximum-pool-size: 10
      connection-timeout: 30000
      connection-test-query: SELECT 1
  sql:
    init:
      mode: always
      schema-locations: classpath:schema.sql
      continue-on-error: false

mybatis-flex:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    cache-enabled: false
  global-config:
    print-sql: true

testcontainers:
  reuse:
    enable: true   # æœ¬åœ°å¯ç”¨é‡ç”¨ï¼ŒåŠ å¿«é€Ÿåº¦

logging:
  level:
    io.github.loadup.modules.{mod}: DEBUG
    com.mybatisflex: DEBUG
    org.springframework.jdbc: DEBUG
```

```yaml
# application-ci.ymlï¼ˆCI ç¯å¢ƒï¼‰
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 5
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-test-query: SELECT 1
  sql:
    init:
      mode: always
      schema-locations: classpath:schema.sql
      continue-on-error: false

mybatis-flex:
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
  global-config:
    print-sql: false

testcontainers:
  reuse:
    enable: false   # CI ç¦ç”¨é‡ç”¨

logging:
  level:
    root: WARN
    io.github.loadup.modules.{mod}: INFO
```

---

## æ•°æ®åº“è§„èŒƒ

### å¿…å¤‡æ ‡å‡†å­—æ®µ ğŸš«

**æ¯å¼ è¡¨éƒ½å¿…é¡»åŒ…å«ä»¥ä¸‹ 5 ä¸ªæ ‡å‡†å­—æ®µï¼Œç¼ºä¸€ä¸å¯ï¼š**

| å­—æ®µ | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------|------|------|
| `id` | `VARCHAR(64)` | `NOT NULL PRIMARY KEY` | UUIDï¼Œä¸šåŠ¡å±‚èµ‹å€¼ï¼Œ**ç¦æ­¢** `BIGINT AUTO_INCREMENT` |
| `tenant_id` | `VARCHAR(64)` | å¯ä¸º NULL | å¤šç§Ÿæˆ·éš”ç¦» |
| `created_at` | `DATETIME` | `NOT NULL DEFAULT CURRENT_TIMESTAMP` | åˆ›å»ºæ—¶é—´ |
| `updated_at` | `DATETIME` | `NULL ON UPDATE CURRENT_TIMESTAMP` | æ›´æ–°æ—¶é—´ |
| `deleted` | `TINYINT` | `NOT NULL DEFAULT 0` | è½¯åˆ é™¤ï¼ˆ0/1ï¼‰ï¼Œ**ç¦æ­¢**ç”¨ `BOOLEAN` |

```sql
id         VARCHAR(64)  NOT NULL                                    COMMENT 'ID',
tenant_id  VARCHAR(64)                                              COMMENT 'ç§Ÿæˆ·ID',
...ä¸šåŠ¡å­—æ®µ...
created_by VARCHAR(64)                                              COMMENT 'åˆ›å»ºäºº',
created_at DATETIME     NOT NULL DEFAULT CURRENT_TIMESTAMP          COMMENT 'åˆ›å»ºæ—¶é—´',
updated_by VARCHAR(64)                                              COMMENT 'æ›´æ–°äºº',
updated_at DATETIME              NULL ON UPDATE CURRENT_TIMESTAMP   COMMENT 'æ›´æ–°æ—¶é—´',
deleted    TINYINT      NOT NULL DEFAULT 0                          COMMENT 'åˆ é™¤æ ‡è®°',
PRIMARY KEY (id),
```

### å…¶ä»–è§„èŒƒ

- è¡¨åï¼š`snake_case`ï¼ˆ`config_item`ã€`dict_type`ï¼Œä¸åŠ  `t_` å‰ç¼€ï¼‰
- å®¡è®¡å­—æ®µï¼ˆå¯é€‰ï¼‰ï¼š`created_by`, `updated_by`ï¼ˆå‡ä¸º `VARCHAR(64)`ï¼‰
- Schemaï¼š`æ¨¡å—æ ¹ç›®å½•/schema.sql`
- Flywayï¼š`src/main/resources/db/migration/V{n}__{desc}.sql`
- **æµ‹è¯• schema å¿…é¡»ä¸ç”Ÿäº§ schema å­—æ®µä¿æŒä¸€è‡´**

---

## å®‰å…¨è§„èŒƒ

- å¯†ç å­—æ®µ `@JsonIgnore`ï¼ŒDTO ä¸æš´éœ²
- æ—¥å¿—ä¸æ‰“å° Token/å¯†ç /æ‰‹æœºå·
- æƒé™æ ¡éªŒï¼š`@RequirePermission("module:action")`
- SQL å…¨éƒ¨ç”¨ `QueryWrapper`ï¼Œç¦æ­¢å­—ç¬¦ä¸²æ‹¼æ¥

---

## æ€§èƒ½è§„èŒƒ

- è¯»å¤šå†™å°‘ â†’ Caffeine æœ¬åœ°ç¼“å­˜ï¼Œå†™æ“ä½œå `evict`
- æ‰¹é‡å†™å…¥ï¼š`insertBatch()` / `updateBatch()`ï¼Œå•æ‰¹ â‰¤ 1000
- é¿å… N+1ï¼Œç”¨ `in()` æ‰¹é‡æŸ¥è¯¢
- åˆ†é¡µä¸Šé™ â‰¤ 200 æ¡

---

## ç¦æ­¢é¡¹é€ŸæŸ¥ ğŸš«

| ç¦æ­¢è¡Œä¸º | æ›¿ä»£æ–¹æ¡ˆ |
|---------|---------|
| ç”Ÿæˆ `/*- #%L ... #L% */` License å¤´ | ä¸å†™ï¼ŒCI è‡ªåŠ¨æ’å…¥ |
| `@RestController` / adapter å±‚ | Gateway `bean://` è·¯ç”± |
| `@Autowired` å­—æ®µæ³¨å…¥ | `@RequiredArgsConstructor` æ„é€ å™¨æ³¨å…¥ |
| é›†æˆæµ‹è¯•ç”¨ `@MockBean` æ›¿æ¢ DB | `@EnableTestContainers(ContainerType.MYSQL)` |
| å­—ç¬¦ä¸²æ‹¼æ¥ SQL | `QueryWrapper` |
| `SELECT *` | æ˜¾å¼åˆ—å‡ºå­—æ®µ |
| modules é—´æ¨ªå‘ä¾èµ– | é€šè¿‡ client æ¨¡å—å…±äº«æ¥å£ |
| domain å±‚åŠ  `@Service` / `@Table` ç­‰æ¡†æ¶æ³¨è§£ | domain æ˜¯çº¯ POJO |
| DO ç›´æ¥ `implements Serializable` è€Œä¸ç»§æ‰¿ `BaseDO` | ç»§æ‰¿ `BaseDO`ï¼Œä½¿ç”¨ `@SuperBuilder` |
| DO ä¸­é‡å¤å®šä¹‰ `id`/`createdAt`/`updatedAt` | è¿™äº›å­—æ®µå·²åœ¨ `BaseDO` ä¸­å®šä¹‰ |
| DO æ”¾åœ¨ domain å±‚ | DO æ”¾åœ¨ infrastructure å±‚ |
| åœ¨ `XxxMapper` ä¸­å†™é¢å¤–æ–¹æ³• | ç”¨ `QueryWrapper` åœ¨ GatewayImpl ä¸­æ“ä½œï¼ŒMapper åªç»§æ‰¿ `BaseMapper<XxxDO>` |
| è¡¨ä¸»é”®ä½¿ç”¨ `BIGINT AUTO_INCREMENT` | ç»Ÿä¸€ä½¿ç”¨ `VARCHAR(64)`ï¼Œä¸šåŠ¡å±‚èµ‹ UUID |
| è¡¨å­—æ®µä½¿ç”¨ `BOOLEAN`/`BOOL` ç±»å‹ | ç»Ÿä¸€ä½¿ç”¨ `TINYINT`ï¼ˆ0=false, 1=trueï¼‰ |
| è¡¨ç¼ºå°‘ `tenant_id`/`deleted`/`created_at`/`updated_at` | æ¯å¼ è¡¨å¿…é¡»åŒ…å«è¿™ 5 ä¸ªæ ‡å‡†å­—æ®µ |
| æµ‹è¯• schema ä¸ç”Ÿäº§ schema å­—æ®µä¸ä¸€è‡´ | æ–°å¢/ä¿®æ”¹å­—æ®µæ—¶åŒæ­¥æ›´æ–°æµ‹è¯• schema |
| æ—¥å¿—æ‰“å°å¯†ç /Token | è„±æ•æˆ–ä¸æ‰“å° |
| æ–°ä¾èµ–ä¸åœ¨ `loadup-dependencies` å£°æ˜ | å…ˆåœ¨ BOM ä¸­å£°æ˜ |
| pom.xml `<parent>` æŒ‡å‘æ¨¡å—è‡ªèº«èšåˆ pom | æ‰€æœ‰å­æ¨¡å— parent ç»Ÿä¸€æŒ‡å‘æ ¹ `loadup-parent` |

---

## pom.xml parent è§„èŒƒ

**æ‰€æœ‰å­æ¨¡å—çš„ `<parent>` å¿…é¡»ç»Ÿä¸€æŒ‡å‘æ ¹ `loadup-parent`**ï¼Œ`relativePath` æŒ‰å­æ¨¡å—åˆ°æ ¹ `pom.xml` çš„å®é™…è·¯å¾„å¡«å†™ï¼š

```xml
<parent>
    <groupId>io.github.loadup-cloud</groupId>
    <artifactId>loadup-parent</artifactId>
    <version>0.0.2-SNAPSHOT</version>
    <relativePath>../../../pom.xml</relativePath>
</parent>
```

| å­æ¨¡å—ä½ç½® | relativePath |
|-----------|--------------|
| `modules/loadup-modules-xxx/loadup-modules-xxx-{layer}/` | `../../../pom.xml` |
| `commons/loadup-commons-xxx/` | `../../pom.xml` |
| `components/loadup-components-xxx/` | `../../pom.xml` |
| `middleware/loadup-gateway/loadup-gateway-xxx/` | `../../../pom.xml` |
| `middleware/loadup-testify/loadup-testify-xxx/` | `../../../pom.xml` |

èšåˆ pomï¼ˆå¦‚ `modules/loadup-modules-xxx/pom.xml`ï¼‰æŒ‡å‘å…¶ç›´æ¥çˆ¶å±‚ï¼ˆ`../../pom.xml`ï¼‰ã€‚

